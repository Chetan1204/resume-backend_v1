<div style="width: 100%;height: 100%;padding: 15px;">
	<div style="display: flex;align-items: center;justify-content: space-between;">
		<div id="all-posts-top-heading">
			<h3>All Post Types</h3>
			<p>Create, edit, and manage the Posts of your site.</p>
		</div>
		<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
	</div>
	<style>
		tbody tr:nth-child(odd) {
			background-color: aliceblue;
		}

		tbody tr:nth-child(even) {
			background-color: #f5f5f5;
		}
	</style>
	<table width="100%" cellspacing="0" cellpadding="0">
		<thead style="border-bottom: 2px solid #d8d8d8;">
			<tr>
				<th>
					<div style="display: flex; align-items: center; justify-content: start;">
						<h3 style="font-size: 12px;text-transform: uppercase;font-weight: 700;margin: 0px;">Name</h3>
					</div>
				</th>
				<th>
					<div style="display: flex; align-items: center; justify-content: start;">
						<h3 style="font-size: 12px;text-transform: uppercase;font-weight: 700;margin: 0px;">Slug</h3>
					</div>
				</th>
				<th>
					<div style="display: flex; align-items: center; justify-content: start;">
						<h3 style="font-size: 12px;text-transform: uppercase;font-weight: 700;margin: 0px;">Custom Field
						</h3>
					</div>
				</th>
				<th>
					<div style="display: flex; align-items: center; justify-content: start;">
						<h3 style="font-size: 12px;text-transform: uppercase;font-weight: 700;margin: 0px;">Post Actions
						</h3>
					</div>
				</th>
				<th>
					<div
						style="display: flex; align-items: center; justify-content: end;gap: 10px;padding-bottom: 5px;">
						<button class="button-main button-main-md" onclick="handleAddNewPostType()">Add New Post
							Type</button>
					</div>
				</th>
			</tr>
		</thead>
		<tbody>

			<% allPostTypes.forEach(post=> { %>
				<tr style="border-bottom: 1px solid rgba(0,0,0,0.25);">
					<td style="padding: 5px 10px;">
						<div style="font-size: 13px;">
							<span style="font-weight: 600;">
								<%= post.postTypeName %>
							</span>
						</div>
					</td>
					<td style="padding: 5px 10px;">
						<div style="font-size: 13px;">
							<span style="font-weight: 600;">
								<%= post.postTypeSlug %>
							</span>
						</div>
					</td>
					<td style="padding: 5px 10px;">
						<div style="font-size: 13px;">
							<span style="font-weight: 600;">
								<%= post.customField.length> 0 ? post.customField[0] : "Unselected" %>
							</span>
						</div>
					</td>
					<td colspan="2" style="padding: 5px 10px;">
						<div
							style="display: flex;width: 100%;align-items: center;justify-content: flex-start;gap: 10px;">
							<span
								style="display: inline-block;padding:3px 5px;cursor: pointer;font-size: 12px; font-weight: 600;"
								onclick="choosePostType('<%= post._id %>')"><i
									class="fa-solid fa-right-long"></i></span>
							<span
								style="display: inline-block;padding:3px 5px;cursor: pointer;font-size: 12px; font-weight: 600;"
								onclick="deletePostType('<%= post.postTypeName %>', '<%= post._id %>')"><i
									class="fa-solid fa-trash-can"></i></span>
							<label for="<%= post.postTypeSlug %>"
								style="font-size: 13px;font-weight: 600;padding-top: 4px;"><i
									class="fa-solid fa-thumbtack"></i></label>
							<input type="checkbox" <%=post?.pin ? 'checked' :"" %> id="<%= post.postTypeSlug %>"
								onchange="handlePinning(this, '<%= post.postTypeName %>', '<%= post._id %>')">
						</div>
					</td>
				</tr>

				<% }) %>
		</tbody>
	</table>
</div>




<script>

	function handlePinning(element, postTypeName, postTypeId) {
		
		fetch("/api/v1/manage/pin-post-type", {
			method: "POST",
			headers: {
				"Content-Type": "application/json"
			},
			body: JSON.stringify({ postTypeName, postTypeId, pin: element.checked })
		}).then(res => res.json).then(data => { window.location.reload(); }).catch(err => console.log(err))
	}

	function handleAddNewPostType() {
		window.location.href = "/api/v1/manage/render-add-post-type";
	}

	function choosePostType(postTypeId) {
		window.location.href = `/api/v1/manage/show-posts-by-post-type/${encodeURIComponent(postTypeId)}`;
	}

	function deletePostType(postTypeName, postTypeId) {
		
		Swal.fire({
			title: 'Do you want to delete this post-type?',
			showDenyButton: true,
			showCancelButton: false,
			confirmButtonText: 'Delete',
			denyButtonText: 'Cancel',
			customClass: {
				actions: 'my-actions',
				cancelButton: 'order-1 right-gap',
				confirmButton: 'order-2',
			},
		}).then((result) => {
			if (result.isConfirmed) {
				fetch("/api/v1/manage/remove-post-type", {
					method: "POST",
					headers: {
						"Content-Type": "application/json"
					},
					body: JSON.stringify({ postTypeName, postTypeId })
				}).then(() => {
					window.location.reload();
				})
			} else if (result.isDenied) {
				Swal.fire('Changes are not saved', '', 'info')
			}
		})
	}
</script>