<div style="width: 100%;height: 100%;padding: 15px;">
	<div style="display: flex;align-items: center;justify-content: space-between;">
		<div id="all-posts-top-heading">
			<h3><%= postTypeName %> Posts</h3>
			<p>Create, edit, and manage the Posts of your site.</p>
		</div>
		<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
	</div>
	<style>
		tbody tr:nth-child(odd) {
			background-color: aliceblue;
		}

		tbody tr:nth-child(even) {
			background-color: #f5f5f5;
		}
	</style>
	<input id="post-type-id" type="hidden" value="<%= postTypeId %>">
	<% if(allPosts?.length> 0) { %>
		<table width="100%" cellspacing="0" cellpadding="0">
			<thead style="border-bottom: 2px solid #d8d8d8;">
				<tr>
					<th>
						<div style="display: flex; align-items: center; justify-content: start;">
							<h3 style="font-size: 12px;text-transform: uppercase;font-weight: 700;margin: 0px;">Post Name</h3>
						</div>
					</th>
					<th>
						<div style="display: flex; align-items: center; justify-content: start;">
							<h3 style="font-size: 12px;text-transform: uppercase;font-weight: 700;margin: 0px;">Post Type</h3>
						</div>
					</th>
					<th>
						<div style="display: flex; align-items: center; justify-content: start;">
							<h3 style="font-size: 12px;text-transform: uppercase;font-weight: 700;margin: 0px;">Post Actions</h3>
						</div>
					</th>
					<th>
						<div style="display: flex; align-items: center; justify-content: end;gap: 10px;padding-bottom: 5px;">
							<button class="button-main button-main-md"
								onclick="openAddPostModal()">
								Create a post
							</button>
						</div>
					</th>
				</tr>
			</thead>
			<tbody>

				<% allPosts.forEach(post=> { %>
					<tr style="border-bottom: 1px solid rgba(0,0,0,0.25);">
						<td style="padding: 5px 10px;">
							<div style="font-size: 13px;">
								<span style="font-weight: 600;">
									<%= post.postName %>
								</span>
							</div>
						</td>
						<td style="padding: 5px 10px;">
							<div style="font-size: 13px;">
								<span style="font-weight: 600;">
									<%= postTypeName %>
								</span>
							</div>
						</td>
						<td colspan="2" style="padding: 5px 10px;">
							<div
								style="display: flex;width: 100%;align-items: center;justify-content: flex-start;gap: 10px;">
								<span
									style="display: inline-block;padding:3px 5px;cursor: pointer;font-size: 12px; font-weight: 600;"
									onclick="editPost('<%= post.postName %>','<%= postTypeId %>')"><i class="fa-solid fa-pen"></i></span>
								<span
									style="display: inline-block;padding:3px 5px;cursor: pointer;font-size: 12px; font-weight: 600;"
									onclick="deletePost('<%= post.postName %>', '<%= post._id %>')"><i
										class="fa-solid fa-trash-can"></i></span>
							</div>
						</td>
					</tr>

					<% }) %>
			</tbody>
		</table>
		<% } else { %>
			<div class="empty-post-bg"
				style="display: flex;flex-direction: column; align-items: center;justify-content: center;height: 400px;">
				<h1 style="color:rgba(0,0,0,0.75);margin-bottom: 25px;">No posts created yet for this post-type</h1>
				<button style="padding: 10px 35px;border:none;outline:none;color: white;font-size: 16px;font-weight: 600;"
					onclick="openAddPostModal()">Create a post</button>
			</div>
		<% } %>
<!-- Modal for creating a post -->
<div id="sectionModal" class="modal">
	<div class="modal-content">
		<span class="close" onclick="closeAddPostModal()">&times;</span>
		<div style="padding: 20px 0;">
			<label class="pb-2" for="elementName">Post Name:</label>
			<input style="width: 100%;display: block;" type="text" id="postName" required>
			<button class="mt-3 button-main button-main-md" onclick="addPost()">Add Post</button>
		</div>
	</div>
</div>
</div>

<script>

	function openAddPostModal() {
		document.getElementById("sectionModal").style.display = "block";
	}

	function closeAddPostModal() {
		document.getElementById("sectionModal").style.display = "none";
	}

	function handleAddNewPost() {
		window.location.href = "/api/v1/manage/render-add-post-type";
	}
	function editPost(postName, postTypeId) {
		window.location.href = `/api/v1/manage/render-post?postname=${encodeURIComponent(postName)}&postid=${encodeURIComponent(postTypeId)}`;
	}

	function addPost() {
		
		const postTypeId = document.getElementById("post-type-id").value;
		const postName = document.getElementById("postName").value;
		fetch("/api/v1/manage/create-post", {
			method:"POST",
			headers:{
				"Content-Type":"application/json"
			},
			body:JSON.stringify({postName, postTypeId})
		}).then(res => res.json()).then(data => window.location.reload())
	}

	function deletePost(postName, postId) {
		
		Swal.fire({
			title: 'Do you want to delete this post?',
			showDenyButton: true,
			showCancelButton: false,
			confirmButtonText: 'Delete',
			denyButtonText: 'Cancel',
			customClass: {
				actions: 'my-actions',
				cancelButton: 'order-1 right-gap',
				confirmButton: 'order-2',
			},
		}).then((result) => {
			if (result.isConfirmed) {
				fetch("/api/v1/manage/remove-post", {
					method: "POST",
					headers: {
						"Content-Type": "application/json"
					},
					body: JSON.stringify({ postName, postId })
				}).then(() => {
					window.location.reload();
				})
			} else if (result.isDenied) {
				Swal.fire('Changes are not saved', '', 'info')
			}
		})
	}
</script>